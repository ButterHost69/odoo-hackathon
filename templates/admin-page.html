<!DOCTYPE html>
<html class="h-full bg-gray-50">

<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Small style for the searchable input inside the form */
        .combobox-input:focus {
            outline: none;
            box-shadow: none;
        }
    </style>
</head>

<body class="h-full">

    <div id="main-admin-div" class="h-full flex">
        <div id="sidebar-div" class="w-64 bg-white border-r border-gray-300 h-full flex flex-col">
            <div class="flex items-center p-4 border-b border-gray-400 bg-white">
                <span class="ml-3 text-lg font-semibold text-gray-800">[Google] Admin</span>
            </div>

            <div class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
                <a href="#"
                    class="flex items-center px-3 py-2 bg-indigo-100 text-indigo-700 rounded-md transition-colors font-semibold">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z">
                        </path>
                    </svg>
                    Users
                </a>

                <a href="#"
                    class="flex items-center px-3 py-2 text-gray-700 rounded-md hover:bg-indigo-50 hover:text-indigo-700 transition-colors">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                        </path>
                    </svg>
                    All Expenses
                </a>

                <a href="#"
                    class="flex items-center px-3 py-2 text-gray-700 rounded-md hover:bg-indigo-50 hover:text-indigo-700 transition-colors">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                        </path>
                    </svg>
                    Reports
                </a>

                <a href="#"
                    class="flex items-center px-3 py-2 text-gray-700 rounded-md hover:bg-indigo-50 hover:text-indigo-700 transition-colors">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Settings
                </a>
            </div>

            <div class="px-4 py-4 border-t border-gray-200">
                <a href="#"
                    class="flex items-center px-3 py-2 text-gray-700 rounded-md hover:bg-red-50 hover:text-red-700 transition-colors">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                        </path>
                    </svg>
                    Logout
                </a>
            </div>
        </div>

        <div id="main-content-div" class="flex-1 flex flex-col overflow-hidden">
            <div class="bg-white border-b border-gray-200 px-6 py-4">
                <h1 class="text-2xl font-semibold text-gray-900">Users</h1>
            </div>

            <main class="flex-1 overflow-y-auto bg-gray-50 p-6">
                <div class="max-w-7xl mx-auto">
                    <div class="mb-6 flex justify-between items-start">
                        <button onclick="showNewUserForm()"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded-lg transition-colors">
                            Add user +
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">User</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Role</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Manager</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Email</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Action</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="users-table-body">
                                <tr class="hover:bg-blue-50 cursor-pointer transition-colors"
                                    onclick="openUserDetails('lindsay-walton')">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Lindsay Walton</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">User</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">John Smith</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                        lindsay.walton@example.com</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button
                                            onclick="event.stopPropagation(); sendPassword('lindsay.walton@example.com')"
                                            class="text-indigo-600 hover:text-indigo-900 font-medium">Send
                                            Password</button>
                                    </td>
                                </tr>
                                <tr class="hover:bg-blue-50 cursor-pointer transition-colors"
                                    onclick="openUserDetails('michael-chen')">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Michael Chen</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Role</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Sarah Johnson</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                        michael.chen@example.com</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button
                                            onclick="event.stopPropagation(); sendPassword('michael.chen@example.com')"
                                            class="text-indigo-600 hover:text-indigo-900 font-medium">Send
                                            Password</button>
                                    </td>
                                </tr>
                                <tr class="hover:bg-blue-50 cursor-pointer transition-colors"
                                    onclick="openUserDetails('emily-davis')">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Emily Davis</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Manager</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">David Wilson</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                        emily.davis@example.com</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button
                                            onclick="event.stopPropagation(); sendPassword('emily.davis@example.com')"
                                            class="text-indigo-600 hover:text-indigo-900 font-medium">Send
                                            Password</button>
                                    </td>
                                </tr>
                                <tr class="hover:bg-blue-50 cursor-pointer transition-colors"
                                    onclick="openUserDetails('alex-rodriguez')">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Alex Rodriguez</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Email</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Lisa Brown</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                        alex.rodriguez@example.com</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button
                                            onclick="event.stopPropagation(); sendPassword('alex.rodriguez@example.com')"
                                            class="text-indigo-600 hover:text-indigo-900 font-medium">Send
                                            Password</button>
                                    </td>
                                </tr>
                                <tr class="hover:bg-blue-50 cursor-pointer transition-colors"
                                    onclick="openUserDetails('sophie-taylor')">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Sophie Taylor</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">User</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Mark Anderson</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                        sophie.taylor@example.com</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <button
                                            onclick="event.stopPropagation(); sendPassword('sophie.taylor@example.com')"
                                            class="text-indigo-600 hover:text-indigo-900 font-medium">Send
                                            Password</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="new-user-row" class="hidden">
                        <form id="new-user-form" onsubmit="handleFormSubmit(event)" onreset="hideNewUserForm()" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Add New User</h3>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label for="new-user-name" class="block text-sm font-medium text-gray-700 mb-1">User Name *</label>
                                    <input type="text" id="new-user-name" name="name"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                        placeholder="Enter user name" required>
                                </div>
                                <div>
                                    <label for="new-user-role" class="block text-sm font-medium text-gray-700 mb-1">Role *</label>
                                    <select id="new-user-role" name="role"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                        required>
                                        <option value="">Select Role</option>
                                        <option value="Employee">Employee</option>
                                        <option value="Manager">Manager</option>
                                    </select>
                                </div>

                                <div class="relative" id="manager-combobox-container">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Manager *</label>
                                    <div class="relative">
                                        <input
                                            type="text"
                                            id="new-user-manager"
                                            name="manager"
                                            placeholder="Search and select manager"
                                            required
                                            readonly
                                            class="combobox-input w-full px-3 py-2 border border-gray-300 rounded-md pr-10 bg-white cursor-pointer focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            onclick="toggleManagerDropdown(event)"
                                        />
                                        <button
                                            type="button"
                                            id="manager-dropdown-toggle"
                                            class="absolute inset-y-0 right-0 flex items-center pr-2"
                                            onclick="toggleManagerDropdown(event)"
                                        >
                                            <svg class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.25 4.25a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                                            </svg>
                                        </button>
                                    </div>
                                    
                                    <div id="manager-options-list" class="absolute z-30 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto hidden">
                                        <div class="p-2 sticky top-0 bg-white border-b border-gray-200 z-40">
                                            <input
                                                type="text"
                                                placeholder="Filter list..."
                                                id="manager-filter-input"
                                                class="w-full p-2 text-sm border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                                oninput="filterManagers(this.value)"
                                            >
                                        </div>
                                        <ul id="manager-list" class="py-1 text-sm text-gray-700 divide-y divide-gray-100">
                                            <li class="px-4 py-2 cursor-pointer hover:bg-indigo-50 hover:text-indigo-700" onclick="selectManager(this)">John Smith</li>
                                            <li class="px-4 py-2 cursor-pointer hover:bg-indigo-50 hover:text-indigo-700" onclick="selectManager(this)">Sarah Johnson</li>
                                            <li class="px-4 py-2 cursor-pointer hover:bg-indigo-50 hover:text-indigo-700" onclick="selectManager(this)">David Wilson</li>
                                            <li class="px-4 py-2 cursor-pointer hover:bg-indigo-50 hover:text-indigo-700" onclick="selectManager(this)">Lisa Brown</li>
                                            <li class="px-4 py-2 cursor-pointer hover:bg-indigo-50 hover:text-indigo-700" onclick="selectManager(this)">Mark Anderson</li>
                                            <li class="px-4 py-2 cursor-pointer hover:bg-indigo-50 hover:text-indigo-700" onclick="selectManager(this)">Jane Doe</li>
                                            <li class="px-4 py-2 cursor-pointer hover:bg-indigo-50 hover:text-indigo-700" onclick="selectManager(this)">Peter Jones</li>
                                        </ul>
                                    </div>
                                </div>

                                <div>
                                    <label for="new-user-email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                                    <input type="email" id="new-user-email" name="email"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                        placeholder="Enter email address" required>
                                </div>
                            </div>
                            <div class="mt-4 flex gap-3">
                                <button type="submit"
                                    class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded-lg transition-colors">
                                    Save
                                </button>
                                <button type="reset"
                                    class="bg-gray-600 hover:bg-gray-700 text-white font-semibold px-4 py-2 rounded-lg transition-colors">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // --- Manager Dropdown Elements ---
        const managerInputField = document.getElementById('new-user-manager');
        const managerOptionsList = document.getElementById('manager-options-list');
        const managerFilterInput = document.getElementById('manager-filter-input');
        const managerList = document.getElementById('manager-list');
        const comboboxContainer = document.getElementById('manager-combobox-container');
        const usersTableBody = document.getElementById('users-table-body');
        const newUserRow = document.getElementById('new-user-row');
        const newUserForm = document.getElementById('new-user-form');


        // ----------------------------------------------------------------------
        // --- DROPDOWN FUNCTIONS (UNCHANGED) ---
        // ----------------------------------------------------------------------

        function toggleManagerDropdown(event) {
            if (event) event.stopPropagation();
            const isHidden = managerOptionsList.classList.contains('hidden');
            if (isHidden) {
                managerOptionsList.classList.remove('hidden');
                managerFilterInput.focus();
            } else {
                managerOptionsList.classList.add('hidden');
                managerFilterInput.value = '';
                filterManagers('');
            }
        }

        function filterManagers(searchTerm) {
            const filter = searchTerm.toLowerCase();
            const items = managerList.children;
            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(filter) ? 'block' : 'none';
            }
        }

        function selectManager(selectedElement) {
            const selectedName = selectedElement.textContent;
            managerInputField.value = selectedName;
            toggleManagerDropdown();
        }

        // --- Global click handler to close the dropdown when clicking outside ---
        document.addEventListener('click', function(event) {
            if (comboboxContainer && !comboboxContainer.contains(event.target)) {
                if (!managerOptionsList.classList.contains('hidden')) {
                    managerOptionsList.classList.add('hidden');
                    managerFilterInput.value = '';
                    filterManagers('');
                }
            }
        });

        // ----------------------------------------------------------------------
        // --- FORM AND UTILITY FUNCTIONS (MODIFIED) ---
        // ----------------------------------------------------------------------

        // Function to show the new user form
        function showNewUserForm() {
            newUserRow.classList.remove('hidden');
            // Scroll to the new user form
            newUserRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Function to hide the new user form (called by form reset)
        function hideNewUserForm() {
             // Delaying the hide allows the form reset (clearing inputs) to happen first
            setTimeout(() => {
                newUserRow.classList.add('hidden');
                // Ensure dropdown is closed and reset
                managerOptionsList.classList.add('hidden');
                managerFilterInput.value = '';
                filterManagers('');
            }, 0);
        }

        /**
         * Handles the form submission (Save button click).
         */
        function handleFormSubmit(event) {
            event.preventDefault(); // Stop the default form submission/page reload

            const name = document.getElementById('new-user-name').value;
            const role = document.getElementById('new-user-role').value;
            const manager = managerInputField.value; 
            const email = document.getElementById('new-user-email').value;
            
            // Note: HTML 'required' attributes handle basic validation, 
            // but we keep the alert for user feedback.
            if (!name || !role || !manager || !email) {
                 // Should be caught by HTML validation, but good backup
                alert('Please fill in all required fields.');
                return;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address.');
                return;
            }

            // --- Logic to create and append the new user row ---
            const userId = name.toLowerCase().replace(/\s+/g, '-') + '-' + Date.now();

            const newRow = document.createElement('tr');
            newRow.className = 'hover:bg-blue-50 cursor-pointer transition-colors';
            newRow.onclick = () => openUserDetails(userId);

            newRow.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${role}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${manager}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${email}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <button onclick="event.stopPropagation(); sendPassword('${email}')" class="text-indigo-600 hover:text-indigo-900 font-medium">Send Password</button>
                </td>
            `;

            // Insert the new row at the beginning of the table
            usersTableBody.insertBefore(newRow, usersTableBody.firstChild);

            // Hide the form and reset fields
            newUserForm.reset(); // This triggers the hideNewUserForm via onreset="hideNewUserForm()"

            alert(`User "${name}" has been added successfully!`);
        }
        
        // Existing utility functions
        function openUserDetails(userId) {
            console.log('Opening user details for:', userId);
            alert(`Opening details for user: ${userId}`);
        }

        function sendPassword(email) {
            console.log('Sending password to:', email);
            alert(`Password reset email sent to: ${email}`);
        }
    </script>

</body>

</html>